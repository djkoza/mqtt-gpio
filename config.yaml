mqtt:
  host: 192.168.25.7
  port: 1883
  username: mqtt
  password: 1234567890
  base_topic: home
  discovery_prefix: homeassistant

device:
  id: "rpi-gpio-node-1"
  name: "Raspberry Pi GPIO Node 1"
  manufacturer: "DIY"
  model: "RPi-GPIO-Node"
  sw_version: "1.0"

logging:
  path: ./server.log
  level: DEBUG            # DEBUG | INFO | WARNING | ERROR
  max_bytes: 1M
  backup_count: 4

# Safety knobs shared by servers (overridable per-entity)
safety:
  min_relay_interval_sec: 0.5     # minimal time gap between relay state changes (↑/↓/stop)
  min_command_interval_sec: 0.2   # minimal time gap between MQTT commands for the same entity
  flap_window_sec: 10             # time window for counting edges for flap detection
  flap_max_edge_changes: 8        # number of relay edges within the window to trigger lockout
  flap_lockout_sec: 15            # lockout duration after flap is detected

# Shutters (covers)
# Each cover supports asymmetric travel times and learning
cover:
  livingroom:
    name: "Livingroom Shutter"
    up_pin: 36
    down_pin: 37
    travel_time_up_sec: 22.0
    travel_time_down_sec: 21.0
    initial_position: 100
    # Optional per-cover overrides:
    # start_delay_up_sec: 0.4
    # start_delay_down_sec: 0.4
    # learning:
    #   enabled: true
    #   alpha: 0.2
    #   clamp_percent: 0.2
    # min_relay_interval_sec: 0.5
    # min_command_interval_sec: 0.2
    # flap_window_sec: 10
    # flap_max_edge_changes: 8
    # flap_lockout_sec: 15

# Learning (global defaults; can be overridden per cover)
learning:
  enabled: true
  alpha: 0.2
  clamp_percent: 0.2

# Persistence for shutter positions
persistence:
  path: ./state.json
  autosave_sec: 3

# Optional global start-delay (motor lag) for shutters
start_delay_up_sec: 0.4
start_delay_down_sec: 0.4

# Lights
light:
  kitchen:
    name: "Kitchen Light"
    pin: 31
  corridor:
    name: "Corridor Light"
    pin: 33
  # Per-light safety overrides are allowed (same keys as 'safety')

# ALSA mixer controls exposed to HA as MQTT Number entities
# Requires: alsa-utils (amixer, alsactl)
alsa:
  poll_sec: 1.0                 # periodic refresh; monitor events wake polling sooner
  enable_monitor: true          # uses 'alsactl monitor' when available
  # min_command_interval_sec: 0.05
  controls:
    dspvolume:
      name: "DSPVolume"
      card: 0
      control: "DSPVolume"
      min: 0
      max: 100
      step: 1
      unit: "%"
      icon: "mdi:volume-high"
      # min_command_interval_sec: 0.05

# Button client
button_queue:
  max_limit: 200
  max_age_sec: 30

# Button inputs and actions
# source: 'gpio' or 'expander'
state:
  - source: gpio
    pin: 29
    # Shutter UP button
    singleClickAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: OPEN
    doubleClickAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set_position
      payload: 80
    longPushStartAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: OPEN
    longPushEndAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: STOP

  - source: gpio
    pin: 32
    # Shutter DOWN button
    singleClickAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: CLOSE
    doubleClickAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set_position
      payload: 20
    longPushStartAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: CLOSE
    longPushEndAction:
      base_topic: home
      component: cover
      object_id: livingroom
      type_topic: set
      payload: STOP
